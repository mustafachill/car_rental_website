<section class="ftco-section contact-section">
    <div class="container">
      <div class="row d-flex mb-5 contact-info">
          <div class="col-md-4">
              <div class="row mb-5">
                <div class="col-md-12">
                    <div class="border w-100 p-4 rounded mb-2 d-flex">
                        <div class="icon mr-3">
                            <span class="icon-map-o"></span>
                        </div>
                      <p><span>Address:</span> 5555 Westheimer Road, Suite 200, Houston, Texas 77056</p>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="border w-100 p-4 rounded mb-2 d-flex">
                        <div class="icon mr-3">
                            <span class="icon-mobile-phone"></span>
                        </div>
                      <p><span>Phone:</span> <a href="tel:+17135557368">+1 (713) 555-7368</a></p>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="border w-100 p-4 rounded mb-2 d-flex">
                        <div class="icon mr-3">
                            <span class="icon-envelope-o"></span>
                        </div>
                      <p><span>Email:</span> <a href="mailto:info@prestigerentals.com">info@prestigerentals.com</a></p>
                    </div>
                </div>
              </div>
        </div>
        <div class="col-md-8 block-9 mb-md-5">
          <!-- Flash Message Container -->
          <div id="flashMessage" style="display: none; position: relative; margin-bottom: 20px;"></div>

          <form id="contactForm" action="#" class="bg-light p-5 contact-form">
            <div class="form-group">
              <input type="text" name="name" id="name" class="form-control" placeholder="Your Name" required>
            </div>
            <div class="form-group">
              <input type="email" name="email" id="email" class="form-control" placeholder="Your Email" required>
            </div>
            <div class="form-group">
              <input type="text" name="subject" id="subject" class="form-control" placeholder="Subject" required>
            </div>
            <div class="form-group">
              <textarea name="message" id="message" cols="30" rows="7" class="form-control" placeholder="Message" required></textarea>
            </div>
            <div class="form-group">
              <input type="submit" value="Send Message" class="btn btn-primary py-3 px-5">
            </div>
          </form>

          <script>
            // Flash message display function with auto-hide
            function showFlashMessage(message, type = 'success') {
              const flashContainer = document.getElementById('flashMessage');
              const isSuccess = type === 'success';

              flashContainer.innerHTML = `
                <div class="alert alert-${isSuccess ? 'success' : 'danger'} alert-dismissible fade show" role="alert" style="animation: slideDown 0.3s ease-out;">
                  <strong>${isSuccess ? '✓ Success!' : '✗ Error!'}</strong> ${message}
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              `;

              flashContainer.style.display = 'block';

              // Scroll to message
              flashContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

              // Auto-hide after 5 seconds
              setTimeout(() => {
                const alert = flashContainer.querySelector('.alert');
                if (alert) {
                  alert.classList.remove('show');
                  setTimeout(() => {
                    flashContainer.style.display = 'none';
                  }, 150);
                }
              }, 5000);
            }

            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
              @keyframes slideDown {
                from {
                  opacity: 0;
                  transform: translateY(-20px);
                }
                to {
                  opacity: 1;
                  transform: translateY(0);
                }
              }
              .alert {
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              }
            `;
            document.head.appendChild(style);

            // Form submission handler
            document.getElementById('contactForm').addEventListener('submit', async function(e) {
              e.preventDefault();

              const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value
              };

              const submitBtn = this.querySelector('input[type="submit"]');
              const originalBtnText = submitBtn.value;

              // Disable submit button and show loading state
              submitBtn.disabled = true;
              submitBtn.value = 'Sending...';
              submitBtn.style.opacity = '0.7';

              try {
                const response = await fetch('/api/contact', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                  showFlashMessage(data.message, 'success');
                  this.reset(); // Clear form
                } else {
                  showFlashMessage(data.error || 'Failed to send message. Please try again.', 'error');
                }
              } catch (error) {
                console.error('Contact form error:', error);
                showFlashMessage('Network error. Please check your connection and try again.', 'error');
              } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.value = originalBtnText;
                submitBtn.style.opacity = '1';
              }
            });
          </script>

        </div>
      </div>
      <div class="row justify-content-center">
          <div class="col-md-12">
              <div id="contactMap" style="width: 100%; height: 450px; border-radius: 8px; z-index: 1;"></div>
          </div>
      </div>
    </div>
  </section>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Houston, TX - 5555 Westheimer Road coordinates (near The Galleria)
      var lat = 29.7382;
      var lng = -95.4610;

      // Initialize the map
      var map = L.map('contactMap', {
        attributionControl: false
      }).setView([lat, lng], 15);

      // Add OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
      }).addTo(map);

      // Custom marker icon
      var customIcon = L.divIcon({
        className: 'custom-map-marker',
        html: '<div style="background-color: #1089ff; width: 30px; height: 30px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -30]
      });

      // Add marker
      var marker = L.marker([lat, lng], {icon: customIcon}).addTo(map);

      // Add popup
      marker.bindPopup('<strong>Prestige Rentals</strong><br>5555 Westheimer Road<br>Suite 200<br>Houston, TX 77056').openPopup();
    });
  </script>