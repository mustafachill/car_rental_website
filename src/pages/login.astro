---
import LoginForm from '../components/LoginForm.jsx';
import ThemeManager from '../components/ThemeManager.astro';
import ThemeToggleButton from '../components/ThemeToggleButton.jsx';

// Check for existing session in cookies
const adminToken = Astro.cookies.get('adminToken');
const userToken = Astro.cookies.get('userToken');

// If user is already logged in, redirect to appropriate dashboard
if (adminToken && adminToken.value) {
  return Astro.redirect('/admin/dashboard');
}

if (userToken && userToken.value) {
  return Astro.redirect('/customer/dashboard');
}
---
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Login - Prestige Rentals</title>
    <ThemeManager />
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans h-full">
    <div class="absolute top-4 right-4"> <ThemeToggleButton client:load /> </div>
    <div class="min-h-screen flex flex-col justify-center items-center p-4">
        <header class="text-center mb-8">
            <a href="/" class="text-5xl text-gray-800 dark:text-white" style="font-family: 'Playfair Display', serif;">Prestige Rentals</a>
            <p class="text-gray-600 dark:text-gray-400 mt-2">Login or create an account to continue.</p>
        </header>
        <main> <LoginForm client:load /> </main>
    </div>

    <!-- Client-side session check for localStorage and sessionStorage tokens -->
    <script>
        // Check localStorage and sessionStorage for tokens
        if (typeof window !== 'undefined') {
            // Check admin token (localStorage)
            const adminToken = localStorage.getItem('adminToken');

            // Check customer token (sessionStorage or localStorage)
            const customerTokenSession = sessionStorage.getItem('customerToken');
            const userToken = localStorage.getItem('userToken');

            if (adminToken) {
                window.location.href = '/admin/dashboard';
            } else if (customerTokenSession || userToken) {
                window.location.href = '/customer/dashboard';
            }
        }
    </script>
</body>
</html>